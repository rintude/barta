<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARTA | Secure Gaming Comms</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background-color: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        .gaming-border {
            border: 2px solid #FF0033;
            clip-path: polygon(5% 0, 100% 0, 100% 90%, 95% 100%, 0 100%, 0 10%);
        }
        .sharp-panel {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 0, 51, 0.3);
        }
        video { width: 100%; border-radius: 4px; background: #111; transform: scaleX(-1); border: 1px solid #333; }
        .screen-share video { transform: none !important; } /* Screen share shouldn't be mirrored */
        .glow-text { text-shadow: 0 0 10px rgba(255, 0, 51, 0.7); }
    </style>
</head>
<body>
    <div class="max-w-6xl mx-auto p-6">
        <header class="flex justify-between items-center mb-8 border-b-2 border-red-600 pb-4">
            <h1 class="text-4xl font-black tracking-tighter text-red-600 glow-text italic">BARTA</h1>
            <div class="text-right">
                <p class="text-xs text-gray-400 uppercase">Status: <span id="status" class="text-yellow-500">Offline</span></p>
                <div class="flex items-center gap-2 justify-end">
                    <p id="display-id" class="font-mono text-white font-bold">No ID</p>
                    <button id="copy-btn" onclick="copyId()" class="hidden text-[10px] bg-zinc-800 px-2 py-1 hover:bg-zinc-700">COPY</button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 md:col-span-4 lg:col-span-3 space-y-4">
                <div class="sharp-panel p-4">
                    <h3 class="text-xs uppercase font-bold text-red-500 mb-3 tracking-widest underline">1. User Identity</h3>
                    <input id="my-custom-id" type="text" placeholder="Enter Secret Code" class="w-full bg-black border border-zinc-800 p-2 mb-2 text-sm focus:border-red-600 outline-none text-white">
                    <button onclick="initializePeer()" class="w-full bg-white text-black hover:bg-red-600 hover:text-white font-bold py-2 transition uppercase text-xs">Authorize ID</button>
                </div>

                <div class="sharp-panel p-4">
                    <h3 class="text-xs uppercase font-bold text-red-500 mb-3 tracking-widest underline">2. Comms Link</h3>
                    <input id="remote-id" type="text" placeholder="Recipient Code" class="w-full bg-black border border-zinc-800 p-2 mb-2 text-sm focus:border-red-600 outline-none">
                    <button onclick="startCall('video')" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 transition uppercase text-xs mb-2">Start Camera</button>
                    <button onclick="startCall('screen')" class="w-full bg-zinc-100 text-black hover:bg-zinc-300 font-bold py-2 transition uppercase text-xs mb-4">Stream Screen</button>
                    <button onclick="endCall()" class="w-full border border-red-600 text-red-600 hover:bg-red-600 hover:text-white font-bold py-2 transition uppercase text-xs">Terminate Call</button>
                </div>
            </div>

            <div class="col-span-12 md:col-span-8 lg:col-span-9">
                <div class="gaming-border p-4 bg-zinc-900/40">
                    <div id="video-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="relative">
                            <p class="absolute top-2 left-2 z-10 text-[10px] bg-red-600 px-2 font-bold uppercase">Local</p>
                            <video id="local-video" autoplay muted playsinline></video>
                        </div>
                        <div class="relative screen-share">
                            <p class="absolute top-2 left-2 z-10 text-[10px] bg-zinc-800 px-2 font-bold text-white uppercase">Remote</p>
                            <video id="remote-video" autoplay playsinline></video>
                        </div>
                    </div>
                    
                    <div id="chat-box" class="h-32 overflow-y-auto bg-black border border-zinc-800 p-4 mb-4 font-mono text-xs text-green-500">
                        <div>> SYSTEM: STANDBY... Awaiting user authorization.</div>
                    </div>
                    <div class="flex gap-2">
                        <input id="msg-input" type="text" placeholder="Type secure message..." class="flex-1 bg-black border border-zinc-800 p-3 text-sm outline-none focus:border-red-600">
                        <button onclick="sendMsg()" class="bg-red-600 px-6 font-black italic hover:bg-red-500">SEND</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-8 text-[10px] text-zinc-600 flex justify-between uppercase tracking-widest border-t border-zinc-900 pt-4">
            <span>Protocol: Peer-to-Peer Encrypted</span>
            <span>Created by: Babai</span>
        </footer>
    </div>

    <script>
        let peer = null;
        let currentCall = null;
        let localStream = null;
        const chatBox = document.getElementById('chat-box');

        function log(msg, color = "text-green-500") {
            chatBox.innerHTML += `<div class="${color}">> ${msg}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function copyId() {
            const id = document.getElementById('display-id').innerText;
            navigator.clipboard.writeText(id);
            log("ID copied to clipboard.");
        }

        function initializePeer() {
            const customId = document.getElementById('my-custom-id').value.trim();
            if (!customId) return alert("Enter a Secret Code!");

            if (peer) peer.destroy();
            peer = new Peer(customId);

            peer.on('open', id => {
                document.getElementById('display-id').innerText = id;
                document.getElementById('status').innerText = "ONLINE";
                document.getElementById('status').className = "text-green-500";
                document.getElementById('copy-btn').classList.remove('hidden');
                log(`Authorization Successful. ID: ${id}`);
            });

            peer.on('call', call => {
                log("Incoming transmission... Auto-patching.", "text-yellow-500");
                const mode = confirm("Accept Incoming Stream?") ? {video: true, audio: true} : null;
                if(!mode) return;

                navigator.mediaDevices.getUserMedia(mode).then(stream => {
                    localStream = stream;
                    document.getElementById('local-video').srcObject = stream;
                    call.answer(stream);
                    currentCall = call;
                    call.on('stream', remoteStream => {
                        document.getElementById('remote-video').srcObject = remoteStream;
                    });
                });
            });

            peer.on('error', err => log(`SIGNAL ERROR: ${err.type}`, "text-red-500"));
        }

        async function startCall(type) {
            const remoteId = document.getElementById('remote-id').value.trim();
            if (!remoteId) return alert("Enter recipient code!");

            try {
                if (type === 'video') {
                    localStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
                } else {
                    localStream = await navigator.mediaDevices.getDisplayMedia({video: true});
                    log("Screen capture initiated.");
                }
                
                document.getElementById('local-video').srcObject = localStream;
                const call = peer.call(remoteId, localStream);
                currentCall = call;
                
                call.on('stream', remoteStream => {
                    document.getElementById('remote-video').srcObject = remoteStream;
                    log("Link established. Secure channel open.");
                });
            } catch (err) {
                log("Media Error: " + err.message, "text-red-500");
            }
        }

        function endCall() {
            if (currentCall) currentCall.close();
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('local-video').srcObject = null;
            document.getElementById('remote-video').srcObject = null;
            log("CHANNEL CLOSED.", "text-red-500");
        }

        function sendMsg() {
            const msg = document.getElementById('msg-input').value;
            if(msg) {
                log(`YOU: ${msg}`, "text-white");
                document.getElementById('msg-input').value = '';
            }
        }
    </script>
</body>
</html>
